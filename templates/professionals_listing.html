{% extends "base.html" %}

{% block title %}
{% if current_category %}
{{ categories|selectattr('id', 'equalto', current_category)|map(attribute='name')|first }} - ×‘×¢×œ×™ ××§×¦×•×¢ ×‘×§×œ×™×§
{% else %}
×‘×¢×œ×™ ××§×¦×•×¢ - ×‘×¢×œ×™ ××§×¦×•×¢ ×‘×§×œ×™×§
{% endif %}
{% endblock %}

{% block content %}
<!-- Page Header -->
<section style="background: var(--background-light); padding: 2rem 0;">
    <div class="container">
        <h1>
        {% if current_category %}
            {{ categories|selectattr('id', 'equalto', current_category)|map(attribute='name')|first }}
        {% else %}
            ×›×œ ×‘×¢×œ×™ ×”××§×¦×•×¢
        {% endif %}
        </h1>
        <p style="color: var(--text-light);">
        {% if professionals|length == 1 %}
            × ××¦× ×‘×¢×œ ××§×¦×•×¢ ××—×“
        {% else %}
            × ××¦××• {{ professionals|length }} ×‘×¢×œ×™ ××§×¦×•×¢
        {% endif %}
        </p>
    </div>
</section>

<!-- Filters -->
<section class="filters">
    <div class="container">
        <form class="filter-group" method="GET">
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label for="category" style="font-weight: 500;">××§×¦×•×¢:</label>
                <select name="category" id="category" class="filter-select" onchange="this.form.submit()">
                    <option value="">×›×œ ×”××§×¦×•×¢×•×ª</option>
                    {% for category in categories %}
                    <option value="{{ category.id }}" {{ 'selected' if current_category == category.id else '' }}>
                        {{ category.name }}
                    </option>
                    {% endfor %}
                </select>
            </div>
            
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label for="city" style="font-weight: 500;">×¢×™×¨:</label>
                <select name="city" id="city" class="filter-select" onchange="this.form.submit()">
                    <option value="">×›×œ ×”×¢×¨×™×</option>
                    <option value="×ª×œ ××‘×™×‘">×ª×œ ××‘×™×‘</option>
                    <option value="×—×™×¤×”">×—×™×¤×”</option>
                    <option value="×™×¨×•×©×œ×™×">×™×¨×•×©×œ×™×</option>
                    <option value="×‘××¨ ×©×‘×¢">×‘××¨ ×©×‘×¢</option>
                    <option value="×¤×ª×— ×ª×§×•×•×”">×¤×ª×— ×ª×§×•×•×”</option>
                </select>
            </div>
            
            <div style="display: flex; align-items: center; gap: 0.5rem;">
                <label for="sort" style="font-weight: 500;">××™×•×Ÿ:</label>
                <select name="sort" id="sort" class="filter-select" onchange="this.form.submit()">
                    <option value="rating">×œ×¤×™ ×“×™×¨×•×’</option>
                    <option value="reviews">×œ×¤×™ ××¡×¤×¨ ×‘×™×§×•×¨×•×ª</option>
                    <option value="experience">×œ×¤×™ × ×™×¡×™×•×Ÿ</option>
                </select>
            </div>
        </form>
    </div>
</section>

<!-- Professionals Grid -->
<section style="padding: 3rem 0;">
    <div class="container">
        {% if professionals %}
        <div class="professionals-grid">
            {% for professional in professionals %}
            <div class="professional-card">
                <div class="professional-header">
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div>
                            <h3 class="professional-name">{{ professional.name }}</h3>
                            <p class="professional-company">{{ professional.company }}</p>
                        </div>
                        <div style="background: var(--background-light); padding: 0.5rem 0.75rem; border-radius: 20px; font-size: 0.875rem;">
                            {{ professional.experience_years }} ×©× ×•×ª × ×™×¡×™×•×Ÿ
                        </div>
                    </div>
                    
                    <div class="professional-rating">
                        <span class="stars">â˜…â˜…â˜…â˜…â˜…</span>
                        <span style="font-weight: 500;">{{ professional.rating }}</span>
                        <span style="color: var(--text-light);">({{ professional.reviews_count }} ×‘×™×§×•×¨×•×ª)</span>
                    </div>
                    
                    <p class="professional-description">{{ professional.description }}</p>
                    
                    <div class="professional-services">
                        {% for service in professional.services %}
                        <span class="service-tag">{{ service }}</span>
                        {% endfor %}
                    </div>
                    
                    {% if professional.last_review %}
                    <div style="background: var(--background-light); padding: 1rem; border-radius: var(--border-radius); margin-top: 1rem;">
                        <p style="font-style: italic; color: var(--text-light); font-size: 0.9rem;">"{{ professional.last_review }}"</p>
                    </div>
                    {% endif %}
                </div>
                
                <div class="professional-footer">
                    <div style="display: flex; align-items: center; gap: 0.5rem;">
                        <span style="font-size: 0.875rem; color: var(--text-light);">ğŸ“</span>
                        <span style="font-size: 0.875rem;">{{ professional.city }}</span>
                    </div>
                    <div style="display: flex; gap: 0.5rem;">
                        <a href="tel:{{ professional.phone }}" class="btn btn-secondary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">ğŸ“ ×”×ª×§×©×¨</a>
                        <a href="{{ url_for('professional_profile', lang=lang, professional_id=professional.id) }}" class="btn btn-primary" style="padding: 0.5rem 1rem; font-size: 0.875rem;">×¦×¤×” ×‘×¤×¨×•×¤×™×œ</a>
                    </div>
                </div>
            </div>
            {% endfor %}
        </div>
        
        <!-- Call to Action -->
        <div style="text-align: center; margin-top: 3rem; padding: 2rem; background: var(--background-light); border-radius: var(--border-radius);">
            <h3>×œ× ××¦××ª× ××ª ××” ×©×—×™×¤×©×ª×?</h3>
            <p style="color: var(--text-light); margin: 1rem 0;">×©×œ×—×• ×‘×§×©×” ×•×ª×§×‘×œ×• ×”×¦×¢×•×ª ××—×™×¨ ××‘×¢×œ×™ ××§×¦×•×¢ ×¨×œ×•×•× ×˜×™×™×</p>
            <a href="{{ url_for('request_quote', lang=lang) }}" class="btn btn-primary">×©×œ×— ×‘×§×©×” ×œ×”×¦×¢×ª ××—×™×¨</a>
        </div>
        
        {% else %}
        <div style="text-align: center; padding: 4rem 0;">
            <h2>×œ× × ××¦××• ×‘×¢×œ×™ ××§×¦×•×¢</h2>
            <p style="color: var(--text-light); margin: 1rem 0;">× ×¡×• ×œ×©× ×•×ª ××ª ×”×¤×™×œ×˜×¨×™× ××•</p>
            <a href="{{ url_for('request_quote', lang=lang) }}" class="btn btn-primary">×©×œ×—×• ×‘×§×©×” ×œ×”×¦×¢×ª ××—×™×¨</a>
        </div>
        {% endif %}
    </div>
</section>
{% endblock %}

{% block structured_data %}
{{ super() }}
<script type="application/ld+json">
{
    "@context": "https://schema.org",
    "@type": "ItemList",
    "name": "×‘×¢×œ×™ ××§×¦×•×¢{% if current_category %} - {{ categories|selectattr('id', 'equalto', current_category)|map(attribute='name')|first }}{% endif %}",
    "itemListElement": [
        {% for professional in professionals %}
        {
            "@type": "LocalBusiness",
            "position": {{ loop.index }},
            "name": "{{ professional.company }}",
            "address": {
                "@type": "PostalAddress",
                "addressLocality": "{{ professional.city }}",
                "addressCountry": "IL"
            },
            "telephone": "{{ professional.phone }}",
            "aggregateRating": {
                "@type": "AggregateRating",
                "ratingValue": "{{ professional.rating }}",
                "reviewCount": "{{ professional.reviews_count }}"
            }
        }{% if not loop.last %},{% endif %}
        {% endfor %}
    ]
}
</script>
{% endblock %}