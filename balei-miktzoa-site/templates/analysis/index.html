<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <title>דשבורד אנליטיקס</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="robots" content="noindex,nofollow" />
  <style>
    body { font-family: Arial, sans-serif; max-width: 1100px; margin: 24px auto; padding: 0 16px; }
    h1 { margin-bottom: 8px; }
    p.hint { color:#555; margin-top:0; }
    .cards { display:grid; grid-template-columns: repeat(auto-fit,minmax(240px,1fr)); gap:16px; margin-top:16px; }
    .card { border:1px solid #ddd; border-radius:10px; padding:18px; background:#fafafa; }
    .card h2 { margin:0 0 8px; font-size:18px; }
    .card p { margin:0 0 12px; color:#444; }
    .card a { display:inline-block; padding:10px 14px; border-radius:8px; text-decoration:none; background:#0b6efd; color:#fff; }
    .note { margin-top:18px; font-size:14px; color:#666; }
    .totals { margin-top:22px; padding:12px 14px; background:#fff; border:1px solid #eee; border-radius:10px; }
    .totals b { margin-inline-start:10px; }
    .months { margin-top:16px; display:flex; flex-wrap:wrap; gap:8px; }
    .chip { background:#fff; border:1px solid #eee; border-radius:999px; padding:6px 10px; font-size:13px; }
    .flash { margin:10px 0; color:#c00; }
  </style>
</head>
<body>
  <h1>דשבורד אנליטיקס</h1>
  <p class="hint">כאן תוכל/י לצפות בדוחות לחודש נוכחי או לכל הזמנים, כולל צפיות בפרופיל, לחיצות "התקשר" ו-WhatsApp.</p>

  {# הודעות פלאש אם יש #}
  {% with messages = get_flashed_messages(with_categories=true) %}
    {% if messages %}
      <div class="flash">
        {% for category, message in messages %}
          <div>{{ message }}</div>
        {% endfor %}
      </div>
    {% endif %}
  {% endwith %}

  {# סיכומי all-time אם הועברו מה-view #}
  {% if all_totals %}
  <div class="totals">
    <b>כל־הזמנים:</b>
    צפיות: {{ all_totals.views | default(0) }} ·
    שיחות: {{ all_totals.calls | default(0) }} ·
    וואטסאפ: {{ all_totals.wa | default(0) }}
  </div>
  {% endif %}

  {# רשימת חודשים זמינים (אופציונלי, תצוגת צ'יפים) #}
  {% if months %}
  <div class="months">
    {% for m in months %}
      <span class="chip">{{ m }}</span>
    {% endfor %}
  </div>
  {% endif %}

  <div class="cards">
    <div class="card">
      <h2>דוח חודשי</h2>
      <p>סיכום לפי חודש נבחר, כולל CTR לכל פעולה.</p>
      <a href="{{ url_for('analysis_monthly') }}">פתח דוח חודשי</a>
    </div>

    <div class="card">
      <h2>כל הזמנים</h2>
      <p>אגרגציה מצטברת על כל החודשים שנשמרו.</p>
      <a href="{{ url_for('analysis_all_time') }}">פתח דוח כללי</a>
    </div>
  </div>

  <p class="note">
    טיפ: אם עדיין לא רואים נתונים, ודא שהאירועים נרשמים (הקוד של <code>/api/track</code> וה-JS באתר פעילים),
    ושנוצרו קבצי <code>.jsonl</code> בתיקיה <code>data/analytics</code>.
  </p>

  {# אין שום סקריפט שמבצע logout בניווט #}
</body>
</html>
