# הפעלת הפרויקט ויצירת תיאורי בעלי מקצוע

## הפעלה מקומית
1. צרו סביבת עבודה מבודדת (אופציונלי אך מומלץ):
   ```bash
   python -m venv .venv
   source .venv/bin/activate
   ```
2. התקינו את התלויות הדרושות ל-Flask ולשירותי ה-AI:
   ```bash
   pip install -U flask pillow python-dotenv deep-translator requests
   ```
3. הפעילו את האפליקציה (הקובץ הראשי הוא `app.clean.py`):
   ```bash
   flask --app app.clean run --debug
   ```
4. כדי לבנות את נכסי ה-frontend (אופציונלי), הריצו:
   ```bash
   npm install
   npm run build
   ```

> **טיפ:** סביבת הפיתוח עושה שימוש במשתני סביבה (`.env`). ודאו שקובץ זה קיים או הגדירו את המשתנים הדרושים ידנית לפני ההרצה.

## תיאורי עובדים: מגבלות מילים חדשות
שירות ה-AI המחודש מחזיר שלושה סגנונות – `neutral_professional`, `service_human`, `urgent_trust` – לכל אחד מהם שני שדות (`teaser`, `body`).

- `teaser` מוגבל ל-28 מילים כדי לשמור על כרטיסים תמציתיים.
- `body` מוגבל ל-85 מילים כך שיתאים לפסקת "קצת עליי" בעמוד הפרופיל.
- רשימת תתי השירותים עוברת דחיסה ל-260 תווים לכל היותר כדי שלא נחרוג מתקציב המילים בפרומפט.

במקרה שה-LLM אינו זמין, מתקבל טקסט דטרמיניסטי זהה במבנהו (כולל מגבלות המילים) כך שהתבניות תמיד מקבלות ערכים בטוחים לתצוגה.

## החלפת מודל ה-LLM
ברירת המחדל מוגדרת בעזרת משתנה הסביבה `AI_MODEL` (עם ערך התחלתי `gemma2:9b-instruct-q4_K_S`). כדי להחליף מודל:

```bash
export AI_MODEL="mistral:7b-instruct"
flask --app app.clean run
```

ניתן גם לשנות את `OLLAMA_URL`, זמני ה-Timeout והטמפרטורה (`AI_T`, `AI_TOP_P`, `AI_RP`) דרך משתני הסביבה התואמים.

## דוגמאות: דחיסה חכמה ושלושה סגנונות
הדוגמאות להלן הופקו באמצעות `describe_worker` עם שירות ה-LLM במצב פולבאק (ללא שרת Ollama פעיל). הן מדגימות כיצד תתי שירותים ארוכים נדחסים וכיצד מתקבלים שלושת הסגנונות.

### אילן חשמל חכם – חשמלאי
- **Sub-services (דחוס):** התקנת לוחות תלת פאזי, איתור קצרי חשמל, תכנון תאורה לבית, חיבור חשמל חכם, התקנת שקעי כוח, שדרוג תשתיות חשמל, בדיקות עומס, תיקון תקלות בלוחות, הוספת נקודות חשמל, התקנת תאורת חוץ, תחזוקת מערכות חשמל
- **Teaser (ניטרלי-מקצועי):** אילן חשמל חכם – התקנת לוחות תלת פאזי, איתור קצרי חשמל, תכנון תאורה לבית, חיבור חשמל חכם, התקנת שקעי כוח, שדרוג תשתיות חשמל, בדיקות עומס, תיקון תקלות בלוחות…
- **Body (שירותי-אנושי):** אילן חשמל חכם עוסק בהתקנת לוחות תלת פאזי, איתור קצרי חשמל, תכנון תאורה לבית, חיבור חשמל חכם, התקנת שקעי כוח, שדרוג תשתיות חשמל, בדיקות עומס, תיקון תקלות בלוחות, הוספת נקודות חשמל, התקנת תאורת חוץ, תחזוקת מערכות חשמל בתל אביב. עם 12 שנות ניסיון תקבלו עבודה אחראית ומסודרת. מדורג 4.9/5 על סמך 87 ביקורות אמיתיות. זמין כעת לשאלות ותיאומים. שמים דגש על יחס אישי, תיאום ציפיות ותקשורת זמינה. שפות שירות: עברית, אנגלית.

### טל המנעולן – מנעולן
- **Sub-services (דחוס):** פריצת מנעולים, החלפת צילינדרים, שדרוג לדלתות חכמות, כיוון דלתות, פתיחת רכבים, פריצת כספות, התקנת מנעולי חיבורית, ייצור מפתחות חירום, התקנת קודנים, שירות לדלתות פלדה
- **Teaser (ניטרלי-מקצועי):** טל המנעולן – פריצת מנעולים, החלפת צילינדרים, שדרוג לדלתות חכמות, כיוון דלתות, פתיחת רכבים, פריצת כספות, התקנת מנעולי חיבורית, ייצור מפתחות חירום, התקנת קודנים, שירות לדלתות פלדה בחיפה
- **Body (שירותי-אנושי):** טל המנעולן עוסק בפריצת מנעולים, החלפת צילינדרים, שדרוג לדלתות חכמות, כיוון דלתות, פתיחת רכבים, פריצת כספות, התקנת מנעולי חיבורית, ייצור מפתחות חירום, התקנת קודנים, שירות לדלתות פלדה בחיפה. מתמחים במנעולים חכמים לדירות ומשרדים. מדורג 4.8/5 על סמך 54 ביקורות אמיתיות. זמין כעת לשאלות ותיאומים. שמים דגש על יחס אישי, תיאום ציפיות ותקשורת זמינה. שפות שירות: עברית, רוסית.

### צוות המים של נופר – אינסטלטור
- **Sub-services (דחוס):** פתיחת סתימות ביוב, צילום קווי ביוב, שיקום צנרת עם שרוול, התקנת מאיצי מים חמים, החלפת קווי מים, איתור נזילות תרמי, התקנת משאבות ניקוז, שיפוץ חדרי רחצה, תחזוקת קולטים, טיפול בנזילות גג, תיקון ברזים תעשייתיים
- **Teaser (ניטרלי-מקצועי):** צוות המים של נופר – פתיחת סתימות ביוב, צילום קווי ביוב, שיקום צנרת עם שרוול, התקנת מאיצי מים חמים, החלפת קווי מים, איתור נזילות תרמי, התקנת משאבות ניקוז…
- **Body (שירותי-אנושי):** צוות המים של נופר עוסק בפתיחת סתימות ביוב, צילום קווי ביוב, שיקום צנרת עם שרוול, התקנת מאיצי מים חמים, החלפת קווי מים, איתור נזילות תרמי, התקנת משאבות ניקוז, שיפוץ חדרי רחצה, תחזוקת קולטים, טיפול בנזילות גג, תיקון ברזים תעשייתיים בראשון לציון. עם 9 שנות ניסיון תקבלו עבודה אחראית ומסודרת. מדורג 5.0/5 על סמך 103 ביקורות אמיתיות. זמין כעת לשאלות ותיאומים. שמים דגש על יחס אישי, תיאום ציפיות ותקשורת זמינה. שפות שירות: עברית.

## פילטר Jinja חדש
`register_jinja_filters` מוסיף כעת את הפילטר `describe_worker`, כך שכל תבנית יכולה לשלוף במידת הצורך את שלושת הסגנונות בצורה קצרה:

```jinja
{% set variants = describe_worker(worker) %}
{{ variants['neutral_professional'].teaser }}
```

הפונקציה מטמיעה קאשינג של 15 דקות לפי טביעת אצבע של נתוני העובד, ולכן קריאות חוזרות באותה בקשה כמעט ולא מוסיפות עלות.